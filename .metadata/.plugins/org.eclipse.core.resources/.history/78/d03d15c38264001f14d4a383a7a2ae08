package com.example.demo.PDFGenerator;

import java.io.FileOutputStream;
import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Value;

import com.example.demo.DAO.EmployeeDatabase;
import com.example.demo.Model.Employee;
import com.itextpdf.text.Document;
import com.itextpdf.text.DocumentException;
import com.itextpdf.text.Element;
import com.itextpdf.text.Paragraph;
import com.itextpdf.text.Phrase;
import com.itextpdf.text.pdf.PdfPCell;
import com.itextpdf.text.pdf.PdfPTable;
import com.itextpdf.text.pdf.PdfWriter;

public class PDFGenerator {

	
	@Value("${pdfDir}")
	private String pdfDir;
	
	@Value("${reportFileName}")
	private String reportFileName;
	
	@Value("${reportFileNameDateFormat}")
	private String reportFileNameDateFormat;
	
	@Value("${localDateFormat}")
	private String localDateFormat;
	
	@Value("${currencySymbol:}")
	private String currencySymbol;
	
	@Value("${table_noOfColumns}")
	private int noOfColumns;
	
	@Value("${table.columnNames}")
	private List<String> columnNames;
	
	@Autowired
	EmployeeDatabase dao;
	
	
	public void generatePDF()
	{
		Document document = new Document();
		try 
		{
			PdfWriter.getInstance(document, new FileOutputStream(getPdfNameWithDate()));
			document.open();
			createTable(document,noOfColumns);
			document.close();
		}
		catch(Exception exception )
		{
			exception.printStackTrace();
		}
	}
	private void createTable(Document document, int columns) throws DocumentException
	{
		Paragraph paragraph = new Paragraph();
	
		document.add(paragraph);
		PdfPTable table = new PdfPTable(columns);
		
		
		for(int i=0; i<columns; i++) 
		{
			PdfPCell cell = new PdfPCell(new Phrase(columnNames.get(i)));
			table.addCell(cell);
		}
		table.setHeaderRows(1);
		populateDBData(table);
		document.add(table);
		
	}
	private void populateDBData(PdfPTable table)
	{
		
		List<Employee> employeeList = dao.findAll();
		for(Employee emp: employeeList)
		{
			table.addCell(employee.getEmpId().toString());
			table.addCell(employee.getEmpName());
			table.addCell(employee.getEmpDept());
		}
		
	}
	
}
