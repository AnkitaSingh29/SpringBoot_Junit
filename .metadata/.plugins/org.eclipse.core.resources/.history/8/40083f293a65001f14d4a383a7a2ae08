package com.example.demo;

import static org.junit.jupiter.api.Assertions.assertEquals;

import java.util.List;

import org.junit.jupiter.api.BeforeAll;
import org.junit.jupiter.api.Test;
import org.mockito.InjectMocks;
import org.mockito.Mock;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.boot.test.mock.mockito.MockBean;
import org.springframework.http.ResponseEntity;

import com.example.demo.DAO.EmployeeDatabase;
import com.example.demo.Model.Employee;
import com.example.demo.Service.EmployeeService;

@SpringBootTest
class DemoApplicationTests {

	@Autowired
	@Mock
	EmployeeDatabase dao;
	
	@Autowired
	@InjectMocks
	EmployeeService empService;
	
	@Autowired
	static Employee emp;
	
	
	@BeforeAll
	public static void beforeTestStart()
	{
		emp = new Employee();
		emp.setCompany("XXXXX");
		emp.setDesignation("XXXX");
		emp.setName("TestUser");
			
	}
	
	@Test
	void addEmployeeTest() {
		
		empService.addEmployee(emp);
		assertEquals(true, findEmployeeByNameTest());
			
	}
	@Test
	void deleteEmployeeTest()
	{
		empService.deleteEmployee(emp);
		assertEquals(false, findEmployeeByNameTest());
	}
	
	
	private boolean findEmployeeByNameTest()
	{
		ResponseEntity<Employee> dbresult = empService.getEmployeeByName(emp.getName());
		 given(dao.findAll())
	      .willReturn(List.of(emp));
		if(dbresult.getBody()!=null)
			return true;
		else
		
			return false;
		
			
	}
}
